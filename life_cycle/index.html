
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://mlup.org/life_cycle/">
      
      
        <link rel="prev" href="../data_transformers/">
      
      
        <link rel="next" href="../python_interface/">
      
      
      <link rel="icon" href="../assets/img/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.6">
    
    
      
        <title>Life cycle - MLup</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.35e1ed30.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.356b1318.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-46XYNH0Q80"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-46XYNH0Q80');
</script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
   (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();
   for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
   k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(95307533, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true,
        webvisor:true
   });
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/95307533" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="cyan">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#life-cycle" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="https://mlup.org" title="MLup" class="md-header__button md-logo" aria-label="MLup" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MLup
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Life cycle
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="cyan"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="cyan" data-md-color-accent="teal"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/nxexox/pymlup" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    PyMLup
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://mlup.org" title="MLup" class="md-nav__button md-logo" aria-label="MLup" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    MLup
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/nxexox/pymlup" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    PyMLup
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PyMLup
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../bash_commands/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Description of the bash commands
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../binarizers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Binarizers
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../config_file/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Config file
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../data_transformers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data transformers
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Life cycle
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Life cycle
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#initializing-the-application" class="md-nav__link">
    Initializing the application
  </a>
  
    <nav class="md-nav" aria-label="Initializing the application">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mlupml" class="md-nav__link">
    mlup.ml
  </a>
  
    <nav class="md-nav" aria-label="mlup.ml">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#upmlload" class="md-nav__link">
    up.ml.load()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upmlload_model_settings" class="md-nav__link">
    up.ml.load_model_settings()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mlupweb" class="md-nav__link">
    mlup.web
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ml-predict-process" class="md-nav__link">
    Ml predict process
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web-application-work" class="md-nav__link">
    Web application work
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web-application-customization" class="md-nav__link">
    Web application customization
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../python_interface/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Description of the Python Interface
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../quickstart/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quickstart
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../storages/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Storages
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../web_app_api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Web app API
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../web_app_architectures/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Web app architectures
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#initializing-the-application" class="md-nav__link">
    Initializing the application
  </a>
  
    <nav class="md-nav" aria-label="Initializing the application">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mlupml" class="md-nav__link">
    mlup.ml
  </a>
  
    <nav class="md-nav" aria-label="mlup.ml">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#upmlload" class="md-nav__link">
    up.ml.load()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#upmlload_model_settings" class="md-nav__link">
    up.ml.load_model_settings()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mlupweb" class="md-nav__link">
    mlup.web
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ml-predict-process" class="md-nav__link">
    Ml predict process
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web-application-work" class="md-nav__link">
    Web application work
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#web-application-customization" class="md-nav__link">
    Web application customization
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="life-cycle">Life cycle</h1>
<p>The entire life process of an mlup application can be divided into two stages - application initialization and running application.</p>
<h2 id="initializing-the-application">Initializing the application</h2>
<p>mlup consists of two main components - <a href="https://github.com/nxexox/pymlup/tree/main/mlup/ml">ml</a> and <a href="https://github.com/nxexox/pymlup/tree/main/mlup/web">web</a>.</p>
<h3 id="mlupml">mlup.ml</h3>
<p>This component contains all the code for working with your model, including all settings associated with the model.</p>
<p>When you create a <code>mlup.UP</code> object and pass a model <code>mlup.UP(ml_model=your_model)</code> into it, mlup does nothing.
At this point, you have simply created a class. This is done in order to avoid starting the processes of loading and analyzing the model, which can be lengthy, without explicit instructions.</p>
<p><img alt="mlup load process" src="../assets/img/mlup-load-scheme.png?raw=true" /></p>
<h4 id="upmlload">up.ml.load()</h4>
<p>To start using your model, you need to load the model into mlup - <code>up.ml.load()</code>.
At this point, mlup first loads your model into memory. In the case of <code>mlup.UP(ml_model=your_model)</code> your model is already loaded and mlup will not load it into memory again.</p>
<p>Loading a model into memory consists of two stages:</p>
<ul>
<li>Loading binary data using <code>storage_type</code>;</li>
<li>Deserilization of binary data into the model;</li>
</ul>
<p>If you use <code>storage_type=mlup.constants.StorageType.disk</code>, by default binary data is not loaded into memory and binarizers themselves load the model during binarization.
This was done to eliminate the possibility of duplicating model data in memory. Binaryizers have access to a local disk, so it is not difficult for them to load the model themselves.
To change this behavior, <code>storage_type=mlup.constants.StorageType.disk</code> has a <code>need_load_file</code> flag, which defaults to False.</p>
<p>The storage concept is needed to load binary model data from different storages to a local disk, from where binarizers will read the data.</p>
<p>Once the model is loaded in memory, <code>up.ml.load_model_settings()</code> is called inside <code>up.ml.load()</code>.</p>
<p>You can check whether the model has been loaded into memory using the <code>up.ml.loaded: bool</code> property. It becomes True only when the model is in memory. 
But it does not indicate whether the model was analyzed using the <code>up.ml.load_model_settings()</code> method.</p>
<h4 id="upmlload_model_settings">up.ml.load_model_settings()</h4>
<p>The <code>up.ml.load_model_settings()</code> method analyzes the loaded model, according to the settings specified in the config, and prepares the <code>mlup.UP</code> object to work with it.</p>
<p>At this point the analysis occurs:</p>
<ul>
<li>Method for prediction;</li>
<li>Method arguments for prediction;</li>
<li>Creating data transformers to convert user data into model format and model response into user format;</li>
<li>Creation of auxiliary entities, such as <code>concurrent.futures.ThreadPoolExecutor</code>;</li>
</ul>
<p>After this, your model is ready to be used via mlup.</p>
<p>If you change some setting related to the operation of the model, just call <code>up.load_model_settings()</code>.
Then mlup will not reload your model into memory, but will simply analyze it again taking into account the changed config.</p>
<pre><code class="language-python">import numpy
import mlup

class MyModel:
    def predict(self, X):
        return X

model = MyModel()

up = mlup.UP(ml_model=model, conf=mlup.Config(auto_detect_predict_params=True))
up.ml.load()

obj_1 = [1, 2, 3]
obj_2 = [4, 5, 6]
objs_for_predict = [obj_1, obj_2]
up.predict_from(X=numpy.array(objs_for_predict))

up.conf.auto_detect_predict_params = False
# Refresh mlup model settings
up.ml.load_model_settings()

up.predict_from(data_for_predict=numpy.array(objs_for_predict))
</code></pre>
<h3 id="mlupweb">mlup.web</h3>
<p>To launch a web application, it also needs to be initialized with <code>up.web.load()</code>.</p>
<p>When using <code>up.run_web_app()</code>, you don't need to worry about this - mlup will initialize it itself.
But if the web component has already been initialized, you need to specify the <code>up.run_web_app(force_load=True)</code> parameter.
If you want to launch your web application in any of the other ways, you need to take care of initializing it yourself - call the <code>up.web.load()</code> method.</p>
<p><em>P.S. You don't have to worry if you forget to call <code>up.web.load()</code>. mlup will not be able to launch the web application and will crash with the error <a href="https://github.com/nxexox/pymlup/blob/main/mlup/errors.py">WebAppLoadError</a></em></p>
<p>Unlike the ml component, the web component has only 1 loading method, <code>up.web.load()</code>, which each time recreates the web app application and reinitializes all settings.</p>
<p>Loading a web application consists of several sequential stages (all of them are hidden inside <code>up.web.load()</code>):</p>
<ul>
<li><code>up.web.load_web_app_settings()</code> - preloading parameters for initializing and launching the application. Here transformations and filling of internal structures take place for the configuration of the web application and the backend of the application.</li>
<li><code>up.web._create_app()</code> - initialization of the web application itself and its backend, construction of the API and application documentation. This is where the analysis results from your machine learning model are most used.</li>
<li><code>self._architecture_obj.load()</code> - initialization of the web application architecture. Some architectures require some operations before launch: initializing workers and queues, adding custom API methods to a web application, and other operations. (See <a href="../web_app_architectures/">Web app architectures</a>).</li>
</ul>
<p>Almost always, you need to call <code>up.web.load()</code> and not worry about its internals. But understanding the initialization order will help you write your own modules correctly and customize the application.</p>
<p>Because the web component builds the API and validation for incoming data, it uses the results of your model analysis.
This means that you will not be able to initialize web first and then ml. The web component needs an initialized ml component to initialize.</p>
<p>Just like in the case of ml, web has the <code>up.web.loaded</code> attribute. It becomes True if and only if a <code>fastapi.FastAPI</code> application is created. 
Those only after calling <code>up.web.load()</code>.</p>
<p>If your application has already called <code>up.web.load()</code>, and then you change the settings, this attribute will still be True. 
You need to independently monitor the reinitialization of the application after updating the config.</p>
<pre><code class="language-python">import mlup

class MyModel:
    def predict(self, X):
        return X

model = MyModel()

up = mlup.UP(ml_model=model)
up.ml.load()

obj_1 = [1, 2, 3]
obj_2 = [4, 5, 6]
objs_for_predict = [obj_1, obj_2]
model_predicted = model.predict(X=objs_for_predict)
mlup_predicted = up.predict(X=objs_for_predict)

print(f'Before call up.web.load: {up.web.loaded}')
up.web.load()
print(f'After call up.web.load and before change config: {up.web.loaded}')
up.conf.port = 8011
print(f'After call up.web.load and after change config: {up.web.loaded}')
up.web.load()
print(f'After double call up.web.load: {up.web.loaded}')
up.run_web_app()

import requests
resp = requests.post('http://0.0.0.0:8011/predict', json={'X': objs_for_predict})
web_app_predicted = resp.json()

up.stop_web_app()

print(model_predicted)
print(mlup_predicted)
print(web_app_predicted)
</code></pre>
<p>After successful initialization of the web component, you can launch your application in a way convenient for you.</p>
<h2 id="ml-predict-process">Ml predict process</h2>
<p>The <code>up.ml.predict</code> method calls the web application for prediction. But you also use it when you call any of the methods: <code>up.predict</code>, <code>up.predict_from</code>, <code>up.async_predict</code>.</p>
<p>Behind it lies a process of several stages:</p>
<ul>
<li>First of all, the main array with object attributes - X - is searched in the transmitted user data. To do this, the <code>up.ml.get_X_from_predict_data</code> method is called.</li>
<li>If X is found, in other words the data is not empty, then the found data X is passed through the data transformer specified in the <code>data_transformer_for_predict</code> configuration parameter. Called <code>up.ml._transform_data_for_predict</code>. See <a href="../data_transformers/">Data Transformers</a>.</li>
<li>If there are problems with the transformation, a <a href="https://github.com/nxexox/pymlup/blob/main/mlup/errors.py">PredictTransformDataError</a> exception will be thrown. If the transformation is successful, the data is used for prediction.</li>
<li>Prediction is the actual call to <code>predict</code> on the model with the transformed data. But depending on the configuration and the <a href="../config_file/">(use_thread_loop) Description of the configuration file</a> parameter, the prediction is run with or without <code>concurrent.futures.ThreadPoolExecutor</code>.</li>
<li>If the prediction caused an error, a <a href="https://github.com/nxexox/pymlup/blob/main/mlup/errors.py">PredictError</a> exception will be thrown.</li>
<li>And if the prediction is successful, the prediction results will be sent to the data transformer from the <code>data_transformer_for_predicted</code> configuration parameter for conversion to a valid JSON format and returned from the method. Called <code>up.ml._transform_predicted_data</code>.</li>
</ul>
<p><img alt="mlup predict process" src="../assets/img/mlup-predict-scheme.png?raw=true" /></p>
<h2 id="web-application-work">Web application work</h2>
<p>After launching the web application, it is ready to accept requests from users. When a developer independently writes a web application with a model, he has full control and knowledge of how the request processing process occurs.
mlup takes care of this, so the entire request processing process is described here.</p>
<p><img alt="mlup web application work process" src="../assets/img/mlup-request-processed.png?raw=true" /></p>
<p>The process looks like this:</p>
<ul>
<li>A request has been received from a user.</li>
<li>If this is not a /predict request, then it immediately goes to the handler. If <code>/predict</code>, wrappers for the handler are processed first:</li>
<li><code>mlup.web.app._set_predict_id_to_response_headers</code> - generates <em>predict_id</em> and sets the request headers to it. Thus, it can be used in the request handler itself and its subfunctions.</li>
<li><code>mlup.web.app._requests_throttling</code> - throttling by the number of requests to the predictor. If the request is not throttled, the web application responds with a 429 response code. Enabling/disabling throttling and configuration can be found in <a href="../config_file/#webapp-work-settings">Description of the configuration file (throttling_max_requests)</a>.</li>
<li>If not <code>/predict</code>, a JSON response is generated and returned to the client. Next we'll look at the <code>/predict</code> method.</li>
<li>During web application initialization, a pydantic model is created to validate incoming data. The Pydantic model is based on the result of model analysis and mlup configuration and is available in the <code>up.web._predict_inner_pydantic_model</code> attribute.
Incoming data is run and validated through this pydantic model. If there are errors, the application immediately responds with a 422 response code with validation errors.</li>
<li>If the validation is successful, validation occurs for the length of the request - the number of objects for predict in the request. If the request is not throttled, the web application responds with a 429 response code. Enabling/disabling and configuration of request length throttling can be found in <a href="../config_file/#webapp-work-settings">Description of the configuration file (throttling_max_request_len)</a></li>
<li>After successfully passing through all stages of validation and throttling, the request is transferred to the architecture for processing, to the <code>up.web._architecture_obj.predict</code> method.</li>
<li>After receiving a response from the architecture component, the web application responds with what the architecture component responded.</li>
</ul>
<p>The processing code itself is short:</p>
<pre><code class="language-python">@_set_predict_id_to_response_headers
@_requests_throttling
async def predict(self, request: FastAPIRequest, response: FastAPIResponse):
    predict_id = response.headers[PREDICT_ID_HEADER]
    # Validation
    try:
        predict_request_body = self._predict_inner_pydantic_model(**(await request.json()))
    except json.JSONDecodeError as e:
        raise PredictValidationInnerDataError(msg=f'Invalid json data: {e}', predict_id=predict_id)
    data_for_predict = predict_request_body.dict()

    # Throttling
    if self.conf.throttling_max_request_len:
        self._request_len_throttling(data_for_predict)

    # Predict in web app architecture object
    predict_result = await self._architecture_obj.predict(data_for_predict, predict_id=predict_id)

    # Result
    return {&quot;predict_result&quot;: predict_result}
</code></pre>
<h2 id="web-application-customization">Web application customization</h2>
<p>If you need to add your own code to initialize the FastAPI application, it is available through the <code>up.web.app: fastapi.FastAPI</code> attribute.</p>
<p>The web application becomes available only after calling <code>up.web.load()</code>. In this method it's created.</p>
<pre><code class="language-python">import mlup
from mlup.ml.empty import EmptyModel


up = mlup.UP(ml_model=EmptyModel(), conf=mlup.Config())
up.ml.load()
up.web.load()

app = up.web.app


def my_api_method():
    return {}


app.add_api_route(&quot;/my-api-method&quot;, my_api_method, methods=[&quot;GET&quot;], name=&quot;my-api-method&quot;)
up.run_web_app()
</code></pre>


  




                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tracking", "search.suggest", "search.highlight", "search.share", "offline"], "search": "../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "stable", "provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.aecac24b.min.js"></script>
      
    
  </body>
</html>